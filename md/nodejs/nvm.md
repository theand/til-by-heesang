
# node.js 의 여러가지 버전을 프로젝트마다 다르게 사용하기

## 발단

요새 언어의 인터프리터/런타임은 시시때때로 버전업이 이루어지고 하위호환성이 깨질때가 많아서 system version 말고 프로젝트 같은 환경마다 언어 버전을 다르게 사용하는 version manager를 많이 사용한다. node.js 에도 같은 역할을 하는 것 중에 하나가 [nvm](https://github.com/creationix/nvm)이다.

하지만 사실 내가 node.js를 메인으로 하는 프로젝트를 빡세게 진행하는 것도 아니어서 처음엔 설치해봤다가 그냥 homebrew로 늘 최신버전으로 업그레이드해서 그걸 써왔다.

그러다가 얼마전부터 새로 맡게 된 프로젝트의 grunt 빌드 결과 파일이 다른 작업자들과 이번에 새로 합류한 나와 같은 작업자들간에 크게 차이가 난다는 것을 오늘 알게 되었다. 왜 그런걸까 추적을 하다보니, 정확히 검증은 하지 못했지만 기본 작업자들은 옛날에 설치한 node.js 6.x를 사용하고 있었고, 새로 합류한 작업자들은 node.js 11.x 를 설치한 상태였다.

그래서 node.js 6.x 와 node.js 11.x 의 런타임을 번갈아가며 동일한 `package-lock.json` 으로 모듈을 설치하면서 빌드를 해서 결과를 비교해보기로 했다.

## 경과

nvm 공식 페이지에서는 homebrew 인스톨은 지원하지 않는다고 명시하고 있지만, 귀찮아서 homebrew 를 택했다.

설치하고, 안내에 따라 `.nvm` 을 생성하고, 필요한 초기화 코드를 쉘 프로파일에 추가했다.

```
brew install nvm
mkdir ~/.nvm
vi .bash_profile
```

nvm 이 지원하는 버전을 살펴보고, 기존 동료가 사용하던 `6.9.2`를 설치하고 그 프로젝트에서는 `6.9.2`를 사용하도록 `.nvmrc` 를 세팅했다.

```
node --version
nvm ls
nvm ls-remote
nvm install 6.9.2
echo "6.9.2" > ~/project/our-project/.nvmrc
nvm use
node --version
```

반복해서 node 런타임을 번갈아 설정하고 node_modules 도 삭제해가며 빌드를 반복해보니, 11.x 를 사용할때와 확실히 다른 결과가 나왔다. 우선 오늘 겪은 node.js 버전에 따른 문제는 짐작가는 부분이 있긴하지만 그에 대한 검증은 시간상 차후로 미루기로 하고, nvm 을 사용해서 작업자들간에 동일한 작동을 하도록 할 수 있다는 조치로 만족하기로 했다.
