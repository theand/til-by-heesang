[TOC]

# 맥 사용 환경 백업과 복구를 자동화하기

어떤 운영체제를 쓰건 각종 설정을 많이 해놓고 쓰는 사용자일수록 장비를 바꾸거나 시스템을 포맷해서 새로 세팅을 하는건 신경써야할 일이 많은 과업이다. 맥 사용자로서 백업과 복구를 최대한 자동화할 수 있는 방법을 찾아보며 정리하기로 한다.


## 히스토리

2014년 즈음에 다니던 회사에서 팀 전체의 개발장비가 윈도우에서 맥북으로 바뀌게 된 일이 있어서, 개발환경 가이드도 할 겸 [Boxen](https://github.com/boxen)을 [포크해서](https://github.com/theand-boxen) 한땀한땀 `Puppetfile` 을 만들어서 팀 내에서 공유하고 이후로는 내 장비가 바뀔때마다 사용하기도 했는데, mac os 및 기타 패키지가 업데이트될때마다 유지보수하는 것도 일이었다. 그래서 기존 `puppet-*` 저장소를 사용하던 스크립트도 대부분 `Homebrew`로 옮기기 시작했고, 1~2년전쯤부터 OS, 패키지의 변경사항을 반영하기가 몹시 피곤해져 손을 놓고 있었다.

맥북 새 장비를 지급받았는데, 각종 프로그램 및 환경을 옮겨 새로 세팅할 여유가 없어 기존 장비 반납 기한을 미루고 미루다가 진행해보려고 알아보니, `Boxen`도 메인테이너가 유지 종료(?)를 [선언했다는 걸](https://github.com/boxen/boxen/issues/224) 알게 되어, 대체할 도구를 찾아보며 정리해보려고 한다.


## 개인적인 조건

내가 쓰는 패턴에 맞는 조건은 아래와 같다.

- 타임머신 사용 안함.
- `Dropbox` 사용 괜찮음.
- provisioning tool 비선호. bash 스크립트 선호.
- 프로그램 설치는 가능한한 `Homebrew` + Cask / MAS 로 한다.
- 터미널 툴의 dotfiles 와 GUI 툴의 Preferences를 모두 옮길 필요 있음.
- macOS Preferences 설정 스크립트도 필요하다.
- 주요 개발환경인 쉘, 에디터, 터미널 환경 관리를 최신화할 필요가 있다 : bash + custom dotfiles, neovim/vimr + spf13vim , iterm 2 정도를 핵심 설정으로 하여 쓰고 있는데, 4,5년전에 세팅한 구닥다리 설정이라는 점이 늘 신경 쓰였다.

# 후보

## Brewfile

현재 사용중인 패키지 목록을 파일 하나로 떨구고, 이를 새 시스템에서 그대로 설치하기에 적합하다.

현 시스템에서 아래 명령어로 `Brewfile` 을 생성하고

```
brew bundle dump
```

새 시스템에서 `Homebrew` 설치된 상태에서 아래 명령어로 해당 파일에 명시된 프로그램 목록을 모두 설치한다. brew, cask, mas 이렇게 3가지 타입 모두 가능한 것 같다.

```
brew bundle
```

참고

- https://github.com/Homebrew/homebrew-bundle
- https://thoughtbot.com/blog/brewfile-a-gemfile-but-for-homebrew

## mackup

https://github.com/lra/mackup

주요 설정 파일들을 드롭박스로 옮기고 원래 경로에서 심볼릭 링크를 걸어주는 방식이다.

첫 인상은 좋지만, 오래 써보니 사용하는 프로그램에 대한 경로가 바뀌거나 할때 바로바로 업데이트되지 않으면 설정이 꼬일 위험이 있다. 특히 Jetbrains 같이 버전업이 일년에 몇번씩 이루어지고 설정 경로가 그때마다 바뀌는 프로그램은 제때 대응이 되지 않는 단점이 있다. 다만 이에 대한 커스터마이징은 가능하긴 하다. 신경쓸 포인트가 늘어나서 문제지.
